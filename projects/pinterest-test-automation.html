<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pinterest Test Automation Framework - Finn Vu Portfolio</title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/project-detail.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div id="header-placeholder"></div>

    <main class="main">
        <div class="container">
            <!-- Intro Section -->
            <div id="intro-placeholder"></div>

            <!-- Main Project -->
            <section class="project-showcase">
                <div class="project-card">
                    <h3><i class="fas fa-vial"></i> Pinterest Test Automation Framework</h3>
                    
                    <!-- GitHub Link -->
                    <div class="github-link-section" style="margin: 20px 0; text-align: center;">
                        <a href="https://github.com/finnvucoding/pytest-pinterest-demo" target="_blank" class="github-btn" style="display: inline-flex; align-items: center; gap: 10px; padding: 12px 24px; background: linear-gradient(135deg, #24292e, #40464d); color: #fff; text-decoration: none; border-radius: 8px; font-weight: 600; transition: all 0.3s ease;">
                            <i class="fab fa-github" style="font-size: 1.3em;"></i> View on GitHub
                        </a>
                    </div>

                    <!-- Project Overview -->
                    <div class="image-section">
                        <h4><i class="fas fa-info-circle"></i> Project Overview</h4>
                        <p>A professional automation testing framework for Pinterest built with <strong>Playwright + Pytest</strong> 
                        using the <strong>Page Object Model (POM)</strong> architecture. This framework provides comprehensive 
                        testing capabilities including login, search, and image download automation with detailed HTML reports.</p>
                    </div>

                    <!-- Report Screenshot -->
                    <div class="image-section">
                        <h4><i class="fas fa-chart-bar"></i> HTML Test Report</h4>
                        <div class="website-image">
                            <img src="../assets/images/pinterest_test_automation_demo/report_html.png" alt="Pinterest Test Automation HTML Report">
                            <p class="image-caption">Detailed HTML test report generated by pytest-html</p>
                        </div>
                    </div>

                    <!-- Statistics -->
                    <div class="stats">
                        <div class="stat-item">
                            <i class="fas fa-sitemap"></i>
                            <span class="stat-number">POM</span>
                            <span class="stat-label">Architecture</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-file-code"></i>
                            <span class="stat-number">5+</span>
                            <span class="stat-label">Page Objects</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-flask"></i>
                            <span class="stat-number">10+</span>
                            <span class="stat-label">Test Cases</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-video"></i>
                            <span class="stat-number">Yes</span>
                            <span class="stat-label">Video Recording</span>
                        </div>
                    </div>

                    <!-- Key Features -->
                    <div class="code-section">
                        <h4><i class="fas fa-star"></i> Key Features</h4>
                        <div class="code-container">
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                            <pre><code class="language-python"># Key Features of the Framework
features = {
    "Architecture": [
        "Page Object Model (POM) with BasePage pattern",
        "Centralized locators management",
        "Environment-based configuration (Local/Staging/Production)",
        "Dataclass-based settings with type hints"
    ],
    "Testing Capabilities": [
        "Login flow automation",
        "Search functionality testing",
        "High-resolution image download",
        "Parameterized test data"
    ],
    "Reliability": [
        "Fallback locator strategy (3-level cascade)",
        "Smart wait mechanisms",
        "Auto-screenshot on failure",
        "Comprehensive error handling"
    ],
    "Reporting": [
        "HTML reports with pytest-html",
        "Video recording for debugging",
        "Detailed logging with emojis",
        "Test markers (smoke, regression, slow)"
    ]
}</code></pre>
                        </div>
                    </div>

                    <!-- Project Structure -->
                    <div class="code-section">
                        <h4><i class="fas fa-folder-tree"></i> Project Structure</h4>
                        <div class="code-container">
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                            <pre><code class="language-text">Pinterest_test/
‚îú‚îÄ‚îÄ config/                 # Configuration (settings, environment)
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ settings.py         # Environment configs, URLs, Timeouts
‚îú‚îÄ‚îÄ core/                   # Base components
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ base_page.py        # BasePage with common actions
‚îÇ   ‚îî‚îÄ‚îÄ logger.py           # Logging utilities
‚îú‚îÄ‚îÄ pages/                  # Page Object Models
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ locators.py         # Centralized locators
‚îÇ   ‚îú‚îÄ‚îÄ home_page.py        # Pinterest Home Page
‚îÇ   ‚îú‚îÄ‚îÄ login_page.py       # Login functionality
‚îÇ   ‚îî‚îÄ‚îÄ search_result_page.py  # Search results handling
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ conftest.py         # Pytest fixtures & hooks
‚îÇ   ‚îî‚îÄ‚îÄ ui/
‚îÇ       ‚îú‚îÄ‚îÄ test_pinterest_search.py
‚îÇ       ‚îî‚îÄ‚îÄ test_download_5_img.py
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îî‚îÄ‚îÄ pinterest_api.py    # API client for downloads
‚îú‚îÄ‚îÄ downloads/              # Downloaded images storage
‚îú‚îÄ‚îÄ screenshots/            # Failure screenshots
‚îú‚îÄ‚îÄ logs/videos/            # Test execution recordings
‚îî‚îÄ‚îÄ reports/                # HTML test reports</code></pre>
                        </div>
                    </div>

                    <!-- BasePage Pattern -->
                    <div class="code-section">
                        <h4><i class="fas fa-layer-group"></i> BasePage Pattern (core/base_page.py)</h4>
                        <div class="code-container">
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                            <pre><code class="language-python">from playwright.sync_api import Locator, Page, expect
from config import settings
from core.logger import log

class BasePage:
    """Base class providing common actions with built-in logging and error handling."""
    
    def __init__(self, page: Page):
        self.page = page

    def open(self, url: str):
        logger.info(f"üåç Navigating to: {url}")
        self.page.goto(url, wait_until="domcontentloaded")

    def click(self, locator: Locator, description: str = "element", **kwargs):
        """Wrapper for click with detailed logging."""
        logger.info(f"üñ±Ô∏è Clicking on '{description}'")
        try:
            locator.click(**kwargs)
        except Exception as e:
            logger.error(f"‚ùå Failed to click '{description}': {str(e)}")
            self.take_screenshot(f"fail_click_{description}")
            raise e

    def fill(self, locator: Locator, text: str, description: str = "field", **kwargs):
        """Wrapper for fill (auto-clears by default in Playwright)."""
        logger.info(f"‚å®Ô∏è Typing '{text}' into '{description}'")
        locator.fill(text, **kwargs)

    def is_visible_slow(self, locator: Locator, timeout: int = 3000) -> bool:
        """Wait briefly to check if element appears (for slow-loading elements)."""
        try:
            locator.wait_for(state="visible", timeout=timeout)
            return True
        except Exception:
            return False

    def take_screenshot(self, name: str):
        """Capture full-page screenshot for debugging."""
        path = f"screenshots/{name}_{settings.get_current_timestamp()}.png"
        self.page.screenshot(path=path, full_page=True)
        logger.info(f"üì∏ Screenshot saved: {path}")</code></pre>
                        </div>
                    </div>

                    <!-- Configuration System -->
                    <div class="code-section">
                        <h4><i class="fas fa-sliders-h"></i> Configuration System (config/settings.py)</h4>
                        <div class="code-container">
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                            <pre><code class="language-python">from dataclasses import dataclass, field
from enum import Enum
from dotenv import load_dotenv
import os
import random

load_dotenv()

class Environment(Enum):
    """Supported test environments."""
    LOCAL = "local"
    STAGING = "staging"
    PRODUCTION = "production"

@dataclass(frozen=True)
class TimeoutConfig:
    """Timeout configurations in milliseconds."""
    DEFAULT_TIMEOUT: int = 30000
    TYPING_TIMEOUT: int = random.randint(300, 500)  # Human-like typing
    SHORT13_TIMEOUT: int = random.randint(1000, 3000)
    LONG_TIMEOUT: int = 60000

@dataclass(frozen=True)
class BrowserSettings:
    """Browser configurations from environment."""
    HEADLESS: bool = field(
        default_factory=lambda: os.getenv("HEADLESS", "false").lower() == "true"
    )
    RECORD_VIDEO: bool = field(
        default_factory=lambda: os.getenv("RECORD_VIDEO", "false").lower() == "true"
    )
    VIEWPORT: Dict[str, int] = field(
        default_factory=lambda: {"width": 1080, "height": 720}
    )
    LOCALE: str = "en-US"</code></pre>
                        </div>
                    </div>

                    <!-- Fallback Locator Strategy -->
                    <div class="code-section">
                        <h4><i class="fas fa-shield-alt"></i> Fallback Locator Strategy (pages/home_page.py)</h4>
                        <div class="code-container">
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                            <pre><code class="language-python">class HomePage(BasePage):
    """Page Object for Pinterest Home Page with fallback strategies."""

    def search_for(self, keyword: str):
        """Perform search with smart element detection."""
        logger.info(f"üîç Searching for: '{keyword}'")
        search_box = self._get_active_search_box()
        search_box.click()
        search_box.type(keyword, delay=settings.timeouts.TYPING_TIMEOUT)
        search_box.press("Enter")

    def _get_active_search_box(self) -> Locator:
        """Find search box using 3-level fallback strategy for reliability."""
        import re
        
        # Option 1: data-test-id - Primary (most stable)
        box_technical = self.page.locator(Loc.SEARCH_INPUT_SELECTOR)
        if self.is_visible_slow(box_technical, timeout=2000):
            return box_technical

        # Option 2: name attribute - Fallback 1
        box_by_name = self.page.locator(Loc.SEARCH_INPUT_BY_NAME)
        if self.is_visible_slow(box_by_name, timeout=2000):
            logger.warning("‚ö†Ô∏è Primary selector failed. Using name attribute fallback.")
            return box_by_name

        # Option 3: Placeholder regex - Fallback 2 (multi-language support)
        box_label = self.page.get_by_placeholder(
            re.compile(Loc.SEARCH_PLACEHOLDER_PATTERN, re.IGNORECASE)
        )
        if self.is_visible_slow(box_label, timeout=2000):
            logger.warning("‚ö†Ô∏è Using placeholder pattern fallback.")
            return box_label

        # All strategies failed
        self.take_screenshot("search_box_missing")
        raise Exception("‚ùå Search box not found with any strategy!")</code></pre>
                        </div>
                    </div>

                    <!-- Image Extraction -->
                    <div class="code-section">
                        <h4><i class="fas fa-images"></i> High-Resolution Image Extraction (pages/search_result_page.py)</h4>
                        <div class="code-container">
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                            <pre><code class="language-python">class SearchResultPage(BasePage):
    """Page Object for Pinterest Search Results with image extraction."""

    def get_image_urls(self, limit: int = 5) -> List[str]:
        """Extract high-resolution image URLs using srcset parsing."""
        logger.info(f"üîç Extracting top {limit} image URLs...")
        self.wait_for_results(min_count=limit)
        
        images = self.page.locator(Loc.PIN_IMAGE_LOADED)
        urls = []
        count = min(images.count(), limit)
        
        for i in range(count):
            img = images.nth(i)
            srcset = img.get_attribute("srcset")
            src = img.get_attribute("src")
            
            if srcset:
                # Format: "url_1x 1x, url_2x 2x, url_4x 4x"
                # Extract highest resolution (last entry = 4x)
                final_url = srcset.split(",")[-1].strip().split(" ")[0]
            else:
                final_url = src
                
            if final_url:
                urls.append(final_url)
                logger.debug(f"‚úÖ Image {i+1}: {final_url}")
                
        logger.info(f"üìù Extracted {len(urls)} high-res URLs")
        return urls

    def wait_for_results(self, min_count: int = 1, timeout: int = 10000) -> int:
        """Smart wait until at least N pins are visible."""
        logger.info(f"‚è≥ Waiting for at least {min_count} pins...")
        self.page.locator(Loc.PIN_ITEM).nth(min_count - 1).wait_for(
            state="visible", timeout=timeout
        )
        return self.get_loaded_pins_count()</code></pre>
                        </div>
                    </div>

                    <!-- Test Cases -->
                    <div class="code-section">
                        <h4><i class="fas fa-flask"></i> Test Cases (tests/ui/test_pinterest_search.py)</h4>
                        <div class="code-container">
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                            <pre><code class="language-python">import pytest
from playwright.sync_api import expect

@pytest.mark.smoke
class TestPinterestSearch:
    """Pinterest search functionality test suite."""

    @pytest.fixture(scope="function", autouse=True)
    def setup_authenticated_state(self, login_page: LoginPage):
        """Ensure user is logged in before each test."""
        logger.info("[SETUP] üîê Ensuring authenticated state...")
        login_page.navigate()
        login_page.login(settings.credentials.email, settings.credentials.password)

    @pytest.mark.parametrize("keyword", [
        pytest.param("Minimalist Decor", id="minimalist_decor"),
        pytest.param("Cyberpunk Art", id="cyberpunk_art"),
        pytest.param("4K Wallpaper", id="4k_wallpaper"),
    ])
    def test_search_flow(
        self,
        home_page: HomePage,
        search_result_page: SearchResultPage,
        keyword: str,
    ):
        """Test search returns valid results for different keywords."""
        home_page.search_for(keyword)
        actual_count = search_result_page.wait_for_results(min_count=1)
        
        assert actual_count > 0, f"Expected pins for '{keyword}', found 0"
        logger.info(f"[TEST] ‚úÖ Found {actual_count} pins for '{keyword}'")</code></pre>
                        </div>
                    </div>

                    <!-- Download Test -->
                    <div class="code-section">
                        <h4><i class="fas fa-download"></i> Image Download Test (tests/ui/test_download_5_img.py)</h4>
                        <div class="code-container">
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                            <pre><code class="language-python">@pytest.mark.smoke
class TestImageDownload:
    """Test suite for downloading high-resolution images."""
    
    def test_download_high_res_images(
        self,
        home_page: HomePage,
        search_result_page: SearchResultPage,
        api_client: PinterestAPIClient
    ):
        """Download 5 high-resolution images and verify file integrity."""
        # 1. SEARCH
        keyword = "4K Wallpaper"
        home_page.search_for(keyword)
        
        # 2. EXTRACT URLs
        target_count = 5
        image_urls = search_result_page.get_image_urls(limit=target_count)
        assert len(image_urls) >= target_count, "Not enough images found"
        
        # 3. DOWNLOAD
        save_dir = DOWNLOAD_DIR / keyword.replace(" ", "_")
        save_dir.mkdir(parents=True, exist_ok=True)
        
        downloaded_count = 0
        for i, url in enumerate(image_urls):
            file_name = f"img_{i+1}_{settings.get_current_timestamp()}.jpg"
            save_path = save_dir / file_name
            
            if api_client.download_file(url, save_path):
                downloaded_count += 1
                
        # 4. VERIFY
        assert downloaded_count == target_count
        for file in save_dir.glob("*"):
            assert file.stat().st_size > 1024, f"File too small: {file.name}"
            
        logger.info(f"[TEST] ‚úÖ Downloaded {downloaded_count} images to: {save_dir}")</code></pre>
                        </div>
                    </div>

                    <!-- How to Run -->
                    <div class="code-section">
                        <h4><i class="fas fa-terminal"></i> How to Run</h4>
                        <div class="code-container">
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                            <pre><code class="language-bash"># 1. Clone the repository
git clone https://github.com/finnvucoding/pytest-pinterest-demo.git
cd pytest-pinterest-demo

# 2. Create virtual environment
python -m venv venv
venv\Scripts\activate  # Windows
# source venv/bin/activate  # Linux/Mac

# 3. Install dependencies
pip install -r requirements.txt

# 4. Install Playwright browsers
playwright install chromium

# 5. Configure environment (.env file)
# PINTEREST_EMAIL=your_email@gmail.com
# PINTEREST_PASSWORD=your_password
# HEADLESS=false
# RECORD_VIDEO=true

# 6. Run tests
pytest                                    # Run all tests
pytest --headed                           # Run with browser visible
pytest tests/ui/test_pinterest_search.py  # Run specific test
pytest -m smoke                           # Run smoke tests only
pytest --html=reports/report.html         # Generate HTML report</code></pre>
                        </div>
                    </div>

                    <!-- Test Markers Table -->
                    <div class="code-section">
                        <h4><i class="fas fa-tags"></i> Test Markers</h4>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Marker</th>
                                    <th>Description</th>
                                    <th>Command</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>smoke</code></td>
                                    <td>Quick sanity tests</td>
                                    <td><code>pytest -m smoke</code></td>
                                </tr>
                                <tr>
                                    <td><code>regression</code></td>
                                    <td>Full regression suite</td>
                                    <td><code>pytest -m regression</code></td>
                                </tr>
                                <tr>
                                    <td><code>slow</code></td>
                                    <td>Slow-running tests</td>
                                    <td><code>pytest -m slow</code></td>
                                </tr>
                                <tr>
                                    <td><code>api</code></td>
                                    <td>API tests</td>
                                    <td><code>pytest -m api</code></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Tech Stack -->
                    <div class="tech-tags">
                        <span class="tech-tag python"><i class="fab fa-python"></i> Python 3.10+</span>
                        <span class="tech-tag playwright">Playwright</span>
                        <span class="tech-tag pytest">Pytest</span>
                        <span class="tech-tag">pytest-html</span>
                        <span class="tech-tag">python-dotenv</span>
                        <span class="tech-tag">Page Object Model</span>
                    </div>

                </div>
            </section>

            <!-- Additional Projects -->
            <div id="additional-projects-placeholder"></div>

        </div>
    </main>

    <div id="footer-placeholder"></div>

    <!-- JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="../assets/js/components.js"></script>
    <script>
        function copyCode(button) {
            const codeBlock = button.nextElementSibling.querySelector('code');
            const text = codeBlock.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                button.textContent = 'Copied!';
                button.style.background = '#38b2ac';
                
                setTimeout(() => {
                    button.textContent = 'Copy';
                    button.style.background = '#4fd1c7';
                }, 2000);
            });
        }
        
        // Add smooth scrolling
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });
    </script>
</body>
</html>
